<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Google Fonts: Inter -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
  <link rel="stylesheet" href="/menu.css">
</head>
<body>
  <!-- Hero Section -->
  <section class="hero">
    <a href="#" id="user-icon" class="user-icon"><i class="fas fa-user"></i></a>
    <nav>
      <a href="/my-menus" style="background: #008080; color: white;">My Menus</a>
      <a href="/orders">Orders</a>
      <a href="/profile">Profile</a>
    </nav>
  </section>

  <!-- Logout Modal -->
  <dialog id="logout-modal" class="logout-dialog">
    <article>
      <a href="#" class="close">×</a>
      <h2>Logout</h2>
      <form action="/logout" method="POST">
        <button type="submit">Confirm Logout</button>
      </form>
    </article>
  </dialog>

  <!-- Menus Section -->
<section id="menus">
  
  <div class="menu-grid">
    
      
        <article>
          <h3>Baudi dzīvo</h3>
          <p>(Drinks, Kebabi)</p>
          <div class="actions">
            <a href="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85">View Public Link</a>
            <a href="/edit-menu/67efa5cb5b28412d6c1efbb1">Edit</a>
            <!-- Mode Toggle -->
            <label>Mode:</label>
            <select onchange="updateMenuMode('67efa5cb5b28412d6c1efbb1', this.value)">
              <option value="view-only" >View-only</option>
              <option value="order" selected>Order</option>
            </select>
          </div>

          <!-- List existing tables -->
          <ul class="tables-list">
            
              <li>
                1 - QR Link: <a href="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff8">/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff8</a>
                <div class="qr-code-container">
                  <img src="" alt="QR Code" class="qr-code" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff8">
                  <button class="download-qr" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff8">Download QR</button>
                </div>
                <div class="actions">
                  <form action="/delete-table/68076272f04cbdf380f99ff8" method="POST">
                    <button type="submit" onclick="return confirm('Are you sure you want to remove this table?');">Remove</button>
                  </form>
                </div>
              </li>
            
              <li>
                2 - QR Link: <a href="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff9">/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff9</a>
                <div class="qr-code-container">
                  <img src="" alt="QR Code" class="qr-code" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff9">
                  <button class="download-qr" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ff9">Download QR</button>
                </div>
                <div class="actions">
                  <form action="/delete-table/68076272f04cbdf380f99ff9" method="POST">
                    <button type="submit" onclick="return confirm('Are you sure you want to remove this table?');">Remove</button>
                  </form>
                </div>
              </li>
            
              <li>
                3 - QR Link: <a href="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ffa">/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ffa</a>
                <div class="qr-code-container">
                  <img src="" alt="QR Code" class="qr-code" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ffa">
                  <button class="download-qr" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=68076272f04cbdf380f99ffa">Download QR</button>
                </div>
                <div class="actions">
                  <form action="/delete-table/68076272f04cbdf380f99ffa" method="POST">
                    <button type="submit" onclick="return confirm('Are you sure you want to remove this table?');">Remove</button>
                  </form>
                </div>
              </li>
            
              <li>
                4 - QR Link: <a href="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=680762a9f04cbdf380f9a03b">/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=680762a9f04cbdf380f9a03b</a>
                <div class="qr-code-container">
                  <img src="" alt="QR Code" class="qr-code" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=680762a9f04cbdf380f9a03b">
                  <button class="download-qr" data-qrlink="/menu/e0605452-42d1-4caf-9f06-e9a8c0fced85?table=680762a9f04cbdf380f9a03b">Download QR</button>
                </div>
                <div class="actions">
                  <form action="/delete-table/680762a9f04cbdf380f9a03b" method="POST">
                    <button type="submit" onclick="return confirm('Are you sure you want to remove this table?');">Remove</button>
                  </form>
                </div>
              </li>
            
            
          </ul>

          <!-- Add new tables -->
          <div class="actions">
            <form action="/create-tables/67efa5cb5b28412d6c1efbb1" method="POST">
              <input type="number" name="tableCount" placeholder="Number of Tables" min="1" required>
              <button type="submit">Add Tables</button>
            </form>
          </div>

          <!-- Delete button moved here -->
          <div class="actions delete-action">
            <form action="/delete-menu/67efa5cb5b28412d6c1efbb1" method="POST">
              <button type="submit" onclick="return confirm('Are you sure you want to delete this menu?');">Delete</button>
            </form>
          </div>
        </article>
      
    

    <article>
      <div class="actions">
        <a href="/create-menu">Create new menu</a>
      </div>
    </article>
  </div>
</section>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="social-links">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-linkedin-in"></i></a>
      </div>
      <div class="contact-info">
        <p><i class="fas fa-envelope"></i> info@qr-table.com</p>
        <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
      </div>
    </div>
    <p>© 2025 QR Menu App. All rights reserved. | <a href="/privacy-policy">Privacy Policy</a> | <a href="#" id="support-link">Support</a></p>
  </footer>

  <!-- Support Modal -->
  <dialog id="support-modal">
    <article>
      <a href="#" class="close">×</a>
      <p>For all support issues, please email <a href="mailto:info@qr-table.com">info@qr-table.com</a></p>
    </article>
  </dialog>

  <!-- JavaScript -->
  <script>
    const userIcon = document.getElementById('user-icon');
    const logoutModal = document.getElementById('logout-modal');
    const logoutCloseBtn = document.querySelector('#logout-modal .close');
    const supportLink = document.getElementById('support-link');
    const supportModal = document.getElementById('support-modal');
    const supportCloseBtn = document.querySelector('#support-modal .close');

    userIcon.addEventListener('click', (e) => {
      e.preventDefault();
      logoutModal.showModal();
    });

    logoutCloseBtn.addEventListener('click', (e) => {
      e.preventDefault();
      logoutModal.close();
    });

    supportLink.addEventListener('click', (e) => {
      e.preventDefault();
      supportModal.showModal();
    });

    supportCloseBtn.addEventListener('click', (e) => {
      e.preventDefault();
      supportModal.close();
    });

    // Define updateMenuMode function
    async function updateMenuMode(menuId, mode) {
      console.log('Updating menu:', menuId, 'to mode:', mode); // Debug log
      try {
        const response = await fetch(`/menus/${menuId}/mode`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ mode })
        });
        if (!response.ok) {
          throw new Error(`Server responded with ${response.status}`);
        }
        console.log('Mode updated successfully'); // Success log
      } catch (error) {
        console.error('Error updating mode:', error);
        alert('Failed to update menu mode.');
      }
    }

    // QR Code generation and download functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Generate QR codes for all tables
      const qrCodeImages = document.querySelectorAll('.qr-code');
      qrCodeImages.forEach(img => {
        const qrLink = img.getAttribute('data-qrlink');
        fetch(`/generate-qr${qrLink}`)
          .then(response => response.json())
          .then(data => {
            img.src = data.qrCodeDataUrl;
          })
          .catch(error => {
            console.error('Error fetching QR code:', error);
          });
      });

      // Download QR code functionality
      const downloadButtons = document.querySelectorAll('.download-qr');
      downloadButtons.forEach(button => {
        button.addEventListener('click', function() {
          const qrLink = this.getAttribute('data-qrlink');
          const qrImage = document.querySelector(`.qr-code[data-qrlink="${qrLink}"]`);
          
          if (qrImage && qrImage.src) {
            // Create a temporary link to download the image
            const link = document.createElement('a');
            link.href = qrImage.src;
            link.download = `qr-code-${qrLink.split('/').pop()}.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }
        });
      });
    });
  </script>
</body>
</html>